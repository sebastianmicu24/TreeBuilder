<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Genogram</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='20' r='8' fill='%232563eb'/><circle cx='30' cy='50' r='8' fill='%232563eb'/><circle cx='70' cy='50' r='8' fill='%232563eb'/><circle cx='20' cy='80' r='6' fill='%2364748b'/><circle cx='40' cy='80' r='6' fill='%2364748b'/><circle cx='60' cy='80' r='6' fill='%2364748b'/><circle cx='80' cy='80' r='6' fill='%2364748b'/><line x1='50' y1='28' x2='30' y2='42' stroke='%232563eb' stroke-width='2'/><line x1='50' y1='28' x2='70' y2='42' stroke='%232563eb' stroke-width='2'/><line x1='30' y1='58' x2='20' y2='74' stroke='%2364748b' stroke-width='2'/><line x1='30' y1='58' x2='40' y2='74' stroke='%2364748b' stroke-width='2'/><line x1='70' y1='58' x2='60' y2='74' stroke='%2364748b' stroke-width='2'/><line x1='70' y1='58' x2='80' y2='74' stroke='%2364748b' stroke-width='2'/></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/controls.css">
    <link rel="stylesheet" href="css/table.css">
    <link rel="stylesheet" href="css/graph.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/mobile.css">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://dagrejs.github.io/project/dagre-d3/latest/dagre-d3.min.js"></script>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>
<body>
    <div class="mobile-overlay" id="mobileOverlay"></div>
    <div class="app-container">
        <button class="mobile-menu-btn" id="mobileMenuBtn" title="Toggle Menu">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
        <aside class="sidebar collapsed" id="sidebar">
            <div class="sidebar-nav">
                <button class="hamburger-btn" id="toggleSidebarBtn" title="Toggle Menu">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
                <div class="nav-items">
                    <button class="nav-item active" data-target="panel-io" title="Input / Output">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        <span class="nav-label">Input / Output</span>
                    </button>
                    <button class="nav-item" data-target="panel-display" title="Display Options">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        <span class="nav-label">Display Options</span>
                    </button>
                    <button class="nav-item" data-target="panel-settings" title="Settings">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                        <span class="nav-label">Settings</span>
                    </button>
                    <button class="nav-item" data-target="panel-data" title="Data Editor">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
                        <span class="nav-label">Data Editor</span>
                    </button>
                </div>
            </div>
            
            <div class="sidebar-panels">
                <div class="sidebar-header">
                    <h1>Clinical Genogram</h1>
                    <button class="mobile-menu-btn" id="closeSidebarBtn" style="display: none; position: static; border: none; box-shadow: none;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                
                <div class="sidebar-content">
                    <div class="control-group" style="flex-direction: column; gap: 8px; margin-bottom: 16px;">
                        <button id="newTreeBtn" class="btn primary full-width">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            New Tree
                        </button>
                    </div>

                    <div id="panel-io" class="nav-panel active">
                        <section class="panel">
                            <h2>Import / Export</h2>
                    <div class="control-group">
                        <div class="io-group">
                            <select id="importFormat" class="io-select">
                                <option value="csv">CSV</option>
                                <option value="json">JSON</option>
                                <option value="gedcom">GEDCOM</option>
                                <option value="fhir">HL7 FHIR</option>
                                <option value="ped">PED</option>
                            </select>
                            <label class="file-upload-btn io-btn">
                                Import
                                <input type="file" id="importFile" accept=".csv,.json,.ged,.fhir,.ped,.txt">
                            </label>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="io-group">
                            <select id="exportFormat" class="io-select">
                                <option value="png">PNG Image</option>
                                <option value="svg">SVG Vector</option>
                                <option value="csv">CSV Data</option>
                                <option value="json">JSON Data</option>
                                <option value="gedcom">GEDCOM</option>
                                <option value="fhir">HL7 FHIR</option>
                                <option value="ped">PED</option>
                            </select>
                            <button id="exportBtn" class="btn secondary io-btn">Export</button>
                        </div>
                    </div>
                    <div class="control-group" id="wordIntegrationGroup" style="display: none; margin-top: 16px;">
                        <button id="insertWordBtn" class="btn primary full-width" style="background: #2b579a; color: white; border: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                            Insert into Word
                        </button>
                    </div>
                        </section>
                    </div>

                    <div id="panel-display" class="nav-panel">
                        <section class="panel">
                            <h2>Display Mode</h2>
                            <div class="display-toggles">
                                <label class="toggle-switch toggle-row">
                                    <input type="checkbox" id="grayscaleMode">
                                    <span class="toggle-label-left">Colors</span>
                                    <span class="toggle-slider"></span>
                                    <span class="toggle-label-right">Grayscale</span>
                                </label>
                                <label class="toggle-switch toggle-row">
                                    <input type="checkbox" id="coupleLineStyle" checked>
                                    <span class="toggle-label-left">Angular Lines</span>
                                    <span class="toggle-slider"></span>
                                    <span class="toggle-label-right">Straight Lines</span>
                                </label>
                            </div>
                            
                            <div class="display-options-group">
                                <h3>Show Elements</h3>
                                <div class="checkbox-grid">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="showNames">
                                        <span>Names</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="showNotes">
                                        <span>Notes</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="showConditions" checked>
                                        <span>Conditions</span>
                                    </label>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div id="panel-settings" class="nav-panel">
                        <section class="panel">
                            <h2>Settings</h2>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>Node Size <span id="nodeSizeVal">40</span></label>
                            <input type="range" id="nodeSize" min="20" max="100" value="40">
                        </div>
                        <div class="setting-item">
                            <label>Vertical Spacing <span id="rankSepVal">50</span></label>
                            <input type="range" id="rankSep" min="20" max="200" value="50">
                        </div>
                        <div class="setting-item">
                            <label>Horizontal Spacing <span id="nodeSepVal">100</span></label>
                            <input type="range" id="nodeSep" min="20" max="250" value="100">
                        </div>
                        <div class="setting-item">
                            <label>Font Size <span id="fontSizeVal">12</span></label>
                            <input type="range" id="fontSize" min="8" max="24" value="12">
                        </div>
                        <div class="setting-item">
                            <label>Text Distance <span id="textDistVal">15</span></label>
                            <input type="range" id="textDist" min="5" max="30" value="15">
                        </div>
                        <div class="setting-item">
                            <label>Font Family</label>
                            <select id="fontFamily">
                                <option value="Arial">Arial</option>
                                <option value="Times New Roman">Times New Roman</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Courier New">Courier New</option>
                                <option value="Verdana">Verdana</option>
                                <option value="Helvetica">Helvetica</option>
                                <option value="Comic Sans MS">Comic Sans MS</option>
                                <option value="Inter" selected>Inter</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>Note Max Width <span id="noteMaxWidthVal">150</span>px</label>
                            <input type="range" id="noteMaxWidth" min="50" max="300" value="150">
                        </div>
                        <div class="setting-item">
                            <label>Genetic Test Line Offset <span id="geneticTestOffsetVal">20</span>px</label>
                            <input type="range" id="geneticTestOffset" min="10" max="30" value="20">
                        </div>
                        <div class="setting-item">
                            <label>Genetic Test Line Width <span id="geneticTestWidthVal">2</span>px</label>
                            <input type="range" id="geneticTestWidth" min="1" max="5" value="2">
                        </div>
                    </div>
                        </section>
                    </div>

                    <div id="panel-data" class="nav-panel">
                        <section class="panel">
                            <h2>Data Editor</h2>
                            <button id="openDataEditorBtn" class="btn secondary full-width">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
                                Open Data Editor
                            </button>
                        </section>
                    </div>
                    
                    <button id="updateBtn" class="btn primary full-width" style="margin-top: auto;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        Update Graph
                    </button>
                </div>
            </div>
        </aside>
        
        <div class="resizer" id="sidebarResizer"></div>

        <main class="main-content">
            <div id="legend" class="legend-overlay"></div>
            <div class="zoom-controls">
                <button id="zoomIn" class="zoom-btn" title="Zoom In">+</button>
                <button id="zoomReset" class="zoom-btn" title="Reset Zoom">⊙</button>
                <button id="zoomOut" class="zoom-btn" title="Zoom Out">−</button>
                <div id="zoomLevel" class="zoom-level">100%</div>
            </div>
            <div class="canvas-container">
                <svg id="genogram"></svg>
            </div>
        </main>

        <!-- Edit Person Modal -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Edit Person</h2>
                    <button class="modal-close" onclick="closeEditModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>ID:</label>
                        <input type="text" id="editId">
                        <small style="color: #64748b; display: block; margin-top: 4px;">Must be unique across all persons</small>
                    </div>
                    <div class="form-group">
                        <label>Sex:</label>
                        <select id="editSex">
                            <option value="M">Male</option>
                            <option value="F">Female</option>
                            <option value="Unknown">Unknown</option>
                            <option value="Abortion">Abortion</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes:</label>
                        <input type="text" id="editNotes">
                    </div>
                    <div class="form-group">
                        <label>Status:</label>
                        <div class="status-dropdown-container" id="editStatusContainer">
                            <button type="button" class="btn secondary status-toggle-btn" id="editStatusBtn">
                                <span class="status-summary-text" id="editStatusSummary">No special status</span>
                                <span class="status-dropdown-arrow">▾</span>
                            </button>
                            <div class="status-dropdown-panel" id="editStatusPanel">
                                <label class="status-checkbox-item">
                                    <input type="checkbox" id="editDead">
                                    <span>Dead</span>
                                </label>
                                <label class="status-checkbox-item">
                                    <input type="checkbox" id="editGeneticTesting">
                                    <span>Had Genetic Testing</span>
                                </label>
                                <label class="status-checkbox-item">
                                    <input type="checkbox" id="editInfertile">
                                    <span>Infertile</span>
                                </label>
                                <label class="status-checkbox-item">
                                    <input type="checkbox" id="editNoChildrenByChoice">
                                    <span>No Children by Choice</span>
                                </label>
                                <label class="status-checkbox-item">
                                    <input type="checkbox" id="editWasAdopted">
                                    <span>Was Adopted</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Condition:</label>
                        <input type="text" id="editCondition">
                    </div>
                    <div class="form-group">
                        <label>Sibling Order:</label>
                        <select id="editSiblingOrder">
                            <option value="0">Automatic</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                        <small style="color: #64748b; display: block; margin-top: 4px;">0 = automatic, 1-N = manual left-to-right order</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn secondary" onclick="closeEditModal()">Cancel</button>
                    <button class="btn primary" onclick="savePersonEdit()">Save</button>
                </div>
                <div class="modal-actions">
                    <h3>Add Related Person</h3>
                    <div class="action-buttons">
                        <button class="btn secondary small" onclick="addRelated('Parent')">Add Parent</button>
                        <button class="btn secondary small" onclick="addRelated('Child')">Add Child</button>
                        <button class="btn secondary small" onclick="addRelated('Sibling')">Add Sibling</button>
                        <button class="btn secondary small" onclick="addRelated('Partner')">Add Partner</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Related Person Modal -->
        <div id="addRelatedModal" class="modal">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    <h2 style="color: white;">
                        <span style="font-size: 1.5em;">+</span> Add Related Person
                    </h2>
                    <button class="modal-close" onclick="closeAddRelatedModal()" style="color: white;">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group" style="background: #f0fdf4; padding: 12px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #10b981;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.5em;">ℹ️</span>
                            <div>
                                <strong>Adding relation to:</strong> <span id="addRelatedToName" style="color: #059669; font-weight: bold;"></span><br>
                                <small style="color: #065f46;">Relationship: <span id="addRelatedType" style="font-weight: 600;"></span></small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ID/Name: <span style="color: #dc2626;">*</span></label>
                        <input type="text" id="addRelatedId" placeholder="Enter unique identifier">
                    </div>
                    <div class="form-group">
                        <label>Sex: <span style="color: #dc2626;">*</span></label>
                        <select id="addRelatedSex">
                            <option value="M">Male</option>
                            <option value="F">Female</option>
                            <option value="Unknown">Unknown</option>
                            <option value="Abortion">Abortion</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes:</label>
                        <input type="text" id="addRelatedNotes" placeholder="Optional notes">
                    </div>
                    <div class="form-group">
                        <label>Status:</label>
                        <div class="status-dropdown-container" id="addRelatedStatusContainer">
                            <button type="button" class="btn secondary status-toggle-btn" id="addRelatedStatusBtn">
                                <span class="status-summary-text" id="addRelatedStatusSummary">No special status</span>
                                <span class="status-dropdown-arrow">▾</span>
                            </button>
                            <div class="status-dropdown-panel" id="addRelatedStatusPanel">
                                <label class="status-checkbox-item">
                                    <input type="checkbox" id="addRelatedDead">
                                    <span>Deceased</span>
                                </label>
                                <label class="status-checkbox-item">
                                    <input type="checkbox" id="addRelatedGeneticTesting">
                                    <span>Had Genetic Testing</span>
                                </label>
                                <label class="status-checkbox-item">
                                    <input type="checkbox" id="addRelatedInfertile">
                                    <span>Infertile</span>
                                </label>
                                <label class="status-checkbox-item">
                                    <input type="checkbox" id="addRelatedNoChildrenByChoice">
                                    <span>No Children by Choice</span>
                                </label>
                                <label class="status-checkbox-item">
                                    <input type="checkbox" id="addRelatedWasAdopted">
                                    <span>Was Adopted</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Condition:</label>
                        <input type="text" id="addRelatedCondition" placeholder="None" value="None">
                        <small style="color: #64748b; display: block; margin-top: 4px;">Separate multiple conditions with commas</small>
                    </div>
                    <div class="form-group">
                        <label>Sibling Order:</label>
                        <select id="addRelatedSiblingOrder">
                            <option value="0">Automatic</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                        <small style="color: #64748b; display: block; margin-top: 4px;">0 = automatic, 1-N = manual left-to-right order</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn secondary" onclick="closeAddRelatedModal()">Cancel</button>
                    <button class="btn primary" onclick="saveAddRelated()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        ✚ Add Person
                    </button>
                </div>
            </div>
        </div>
        <!-- Data Editor Modal -->
        <div id="dataEditorModal" class="modal">
            <div class="modal-content data-editor-modal">
                <div class="modal-header">
                    <h2>Data Editor</h2>
                    <button class="modal-close" onclick="closeDataEditorModal()">&times;</button>
                </div>
                <div class="modal-body data-editor-body">
                    <div class="table-wrapper">
                        <table id="dataTable">
                            <thead>
                                <tr>
                                    <th>Role</th>
                                    <th>Id</th>
                                    <th>Sex</th>
                                    <th>Notes</th>
                                    <th>Dead</th>
                                    <th>Condition</th>
                                    <th>Gen.Test</th>
                                    <th>Sib.</th>
                                    <th>Infertile</th>
                                    <th>No Ch.</th>
                                    <th>Adopted</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="addRowBtn" class="btn secondary">+ Add Row</button>
                    <div style="flex: 1;"></div>
                    <button class="btn secondary" onclick="closeDataEditorModal()">Close</button>
                    <button class="btn primary" onclick="saveDataEditor()">Apply Changes</button>
                </div>
            </div>
        </div>

        <!-- Setup Form Modal -->
        <div id="setupWizardModal" class="modal">
            <div class="modal-content setup-form-modal">
                <div class="modal-header setup-header">
                    <div>
                        <h2>New Genogram</h2>
                        <p class="setup-subtitle">Configure the family tree structure</p>
                    </div>
                    <button class="modal-close" onclick="closeSetupWizard()">&times;</button>
                </div>
                <div class="modal-body setup-form-body">
                    <!-- Generations -->
                    <div class="setup-fieldset">
                        <div class="setup-fieldset-label">Generations</div>
                        <div class="setup-segmented-control">
                            <label class="setup-segment">
                                <input type="radio" name="detailLevel" value="parents">
                                <span>Parents</span>
                            </label>
                            <label class="setup-segment">
                                <input type="radio" name="detailLevel" value="grandparents" checked>
                                <span>Grandparents</span>
                            </label>
                            <label class="setup-segment">
                                <input type="radio" name="detailLevel" value="greatgrandparents">
                                <span>Great-Grandparents</span>
                            </label>
                        </div>
                    </div>

                    <!-- Patient Sex -->
                    <div class="setup-fieldset">
                        <div class="setup-fieldset-label">Patient Sex</div>
                        <div class="setup-segmented-control">
                            <label class="setup-segment">
                                <input type="radio" name="patientSex" value="M" checked>
                                <span>&#9794; Male</span>
                            </label>
                            <label class="setup-segment">
                                <input type="radio" name="patientSex" value="F">
                                <span>&#9792; Female</span>
                            </label>
                            <label class="setup-segment">
                                <input type="radio" name="patientSex" value="Unknown">
                                <span>&#9671; Unknown</span>
                            </label>
                        </div>
                    </div>

                    <!-- Patient's Children -->
                    <div class="setup-fieldset">
                        <div class="setup-fieldset-label">Patient's Children</div>
                        <div class="setup-input-grid">
                            <div class="setup-input-cell">
                                <label>&#9794; Male</label>
                                <input type="number" id="wizPatientChildrenMale" min="0" placeholder="0">
                            </div>
                            <div class="setup-input-cell">
                                <label>&#9792; Female</label>
                                <input type="number" id="wizPatientChildrenFemale" min="0" placeholder="0">
                            </div>
                            <div class="setup-input-cell">
                                <label>&#9671; Unknown</label>
                                <input type="number" id="wizPatientChildrenUnknown" min="0" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <!-- Patient's Siblings -->
                    <div class="setup-fieldset">
                        <div class="setup-fieldset-label">Patient's Siblings</div>
                        <div class="setup-input-grid">
                            <div class="setup-input-cell">
                                <label>&#9794; Male</label>
                                <input type="number" id="wizPatientBrothers" min="0" placeholder="0">
                            </div>
                            <div class="setup-input-cell">
                                <label>&#9792; Female</label>
                                <input type="number" id="wizPatientSisters" min="0" placeholder="0">
                            </div>
                            <div class="setup-input-cell">
                                <label>&#9671; Unknown</label>
                                <input type="number" id="wizPatientUnknown" min="0" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <!-- Father's Siblings -->
                    <div class="setup-fieldset">
                        <div class="setup-fieldset-label">Father's Siblings</div>
                        <div class="setup-input-grid">
                            <div class="setup-input-cell">
                                <label>&#9794; Male</label>
                                <input type="number" id="wizFatherBrothers" min="0" placeholder="0">
                            </div>
                            <div class="setup-input-cell">
                                <label>&#9792; Female</label>
                                <input type="number" id="wizFatherSisters" min="0" placeholder="0">
                            </div>
                            <div class="setup-input-cell">
                                <label>&#9671; Unknown</label>
                                <input type="number" id="wizFatherUnknown" min="0" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <!-- Mother's Siblings -->
                    <div class="setup-fieldset">
                        <div class="setup-fieldset-label">Mother's Siblings</div>
                        <div class="setup-input-grid">
                            <div class="setup-input-cell">
                                <label>&#9794; Male</label>
                                <input type="number" id="wizMotherBrothers" min="0" placeholder="0">
                            </div>
                            <div class="setup-input-cell">
                                <label>&#9792; Female</label>
                                <input type="number" id="wizMotherSisters" min="0" placeholder="0">
                            </div>
                            <div class="setup-input-cell">
                                <label>&#9671; Unknown</label>
                                <input type="number" id="wizMotherUnknown" min="0" placeholder="0">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer setup-footer">
                    <button class="btn secondary" onclick="closeSetupWizard()">Cancel</button>
                    <button class="btn primary setup-build-btn" onclick="wizardBuild()">Build Tree</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/io/csv.js"></script>
    <script src="js/io/json.js"></script>
    <script src="js/io/gedcom.js"></script>
    <script src="js/io/fhir.js"></script>
    <script src="js/io/ped.js"></script>
    <script src="js/io/svg.js"></script>
    <script src="js/io/png.js"></script>
    <script src="js/io/index.js"></script>
    <script src="js/graph.js"></script>
    <script src="js/patterns.js"></script>
    <!-- Renderer submodules (loaded before the orchestrator) -->
    <script src="js/renderer/pickers.js"></script>
    <script src="js/renderer/legend.js"></script>
    <script src="js/renderer/svg-patterns.js"></script>
    <script src="js/renderer/layout.js"></script>
    <script src="js/renderer/node-decorations.js"></script>
    <script src="js/renderer.js"></script>
    <!-- UI submodules (loaded before main) -->
    <script src="js/ui/table.js"></script>
    <script src="js/ui/modals.js"></script>
    <script src="js/ui/wizard.js"></script>
    <script src="js/main.js"></script>
</body>
</html>